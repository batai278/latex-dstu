\section{Формули}

\begin{equation*}
  Z = <T, K, \tau, g, q>
\end{equation*}

\begin{equation*}
  \tau \subset T^2
\end{equation*}

\begin{equation*}
  g: \tau \times K^2 \rightarrow \mathbb{R}
\end{equation*}

\begin{equation*}
  q: T \times K \rightarrow \mathbb{R}
\end{equation*}

\begin{equation*}
  \vec{k}^* = \argmax\limits_{\vec{k} \in K} \left\{
    \sum_{tt' \in \tau} g_{tt'}\left( k_{t}, k_{t'} \right) +
    \sum_{t \in T} q_{t} \left( k_{t} \right)
  \right\}
\end{equation*}

\begin{equation*}
  \begin{split}
    E\left( Z \right) =
      \sum_{tt' \in \tau} \max\limits_{k, k' \in K}{
        \left\{g_{tt'}\left( k_{t}, k'_{t'} \right)\right\}} +
      \sum_{t \in T} \max\limits_{k \in K}{
        \left\{q_{t} \left( k_{t} \right)\right\}}
    \ge \\ \ge
      \max\limits_{k \in K}{\left\{
        \sum_{tt' \in \tau} g_{tt'}\left( k_{t}, k_{t'} \right) +
      \sum_{t \in T} q_{t} \left( k_{t} \right)\right\}}
  \end{split}
\end{equation*}

\section{Задача}

\begin{equation*}
  \Phi = \left\{ \varphi_{tt'}\left( k \right) \mid
                t \in T, k \in K, t' \in N\left( t \right)\right\}
\end{equation*}

\begin{equation*}
  g'_{tt'} \left( k_{t}, k'_{t'} \right) = g_{tt'} \left( k_{t}, k'_{t'} \right)
    + \varphi_{tt'}\left( k \right) + \varphi_{t't}\left( k' \right)
\end{equation*}

\begin{equation*}
  q'_{t} \left( k_{t} \right) = q_{t}\left( k_{t} \right)
    - \sum_{t' \in N\left( t \right)} \varphi_{tt'} \left( k \right)
\end{equation*}

\begin{equation*}
  \begin{split}
    E\left( \Phi \right) =
      \sum_{tt' \in \tau} \max\limits_{k, k' \in K}{
        \left\{g_{tt'}\left( k_{t}, k'_{t'} \right) +
        \varphi_{tt'}\left( k \right) + \varphi_{t't}\left( k' \right)
      \right\}} + \\ +
      \sum_{t \in T} \max\limits_{k \in K}{
        \left\{q_{t} \left( k_{t} \right) -
        \sum_{t' \in N\left( t \right)} \varphi_{tt'} \left( k \right)\right\}}
    \rightarrow min
  \end{split}
\end{equation*}

\section{Розв'язок}

\begin{equation*}
  \begin{split}
    k_{t}^{q}
      =& \argmax\limits_{k \in K}{
        \left\{q_{t} \left( k_{t} \right)\right\}} \\
    \left( k_{t}^{g}, k_{t'}^{g} \right)
      =& \argmax\limits_{k, k' \in K}{
        \left\{g_{tt'}\left( k_{t}, k'_{t'} \right)\right\}}
  \end{split}
\end{equation*}

\begin{equation*}
  \frac{\partial E\left( \Phi \right)}{\partial \varphi_{tt'}\left( k \right)} =
  \begin{cases}
    1,& k_{t}^{g} = k \neq k_{t}^{q} \\
    -1,& k_{t}^{g} \neq k = k_{t}^{g} \\
    0,& otherwise
  \end{cases}
\end{equation*}

\begin{algorithm}
  \caption{Крок}
  \begin{algorithmic}[1]
    \FORALL{$\left( t, t' \right) \in \tau$}
      \STATE $\left( k, k' \right) \gets \argmax\limits_{k, k' \in K}{
          \left\{g_{tt'}\left( k_{t}, k'_{t'} \right) +
          \varphi_{tt'}\left( k \right) + \varphi_{t't}\left( k' \right)
        \right\}}$
      \STATE $\varphi_{tt'}\left( k \right)
        \gets \varphi_{tt'}\left( k \right) - \gamma_{i}$
      \STATE $\varphi_{t't}\left( k' \right)
        \gets \varphi_{t't}\left( k' \right) - \gamma_{i}$
    \ENDFOR
    \FORALL{$t \in T$}
      \STATE $k \gets \argmax\limits_{k \in K}{\left\{
          q_{t} \left( k_{t} \right) -
              \sum_{t' \in N\left( t \right)} \varphi_{tt'} \left( k \right)
        \right\}}$
      \FORALL{$t' \in N\left( t \right)$}
        \STATE $\varphi_{tt'}\left( k \right)
          \gets \varphi_{tt'}\left( k \right) + \gamma_{i}$
      \ENDFOR
    \ENDFOR
  \end{algorithmic}
\end{algorithm}


\section{МНК}

\begin{equation*}
  R\left( \vec{l}, c \right)
  = \sum_{p \in I} \left( \vec{n}^p \cdot \vec{l} + c - y^p \right)^2
  \rightarrow \min.
\end{equation*}

\begin{equation*}
  \frac{\partial R}{\partial l_e}
  = 2 \cdot \sum_{p \in I}
    \left( \vec{n}^p \cdot \vec{l} + c - y^p \right) \cdot n_e^p
  = 0,
  \qquad e \in \left\{ x, y, z \right\},
\end{equation*}

\begin{equation*}
  \frac{\partial R}{\partial c}
  = 2 \cdot \sum_{p \in I}
    \left( \vec{n}^p \cdot \vec{l} + c - y^p \right)
  = 0.
\end{equation*}

\begin{equation*}
  n_e = \left\| \vec{n}^p \right\|_{p \in I},
  \qquad e \in \left\{ x, y, z \right\},
\end{equation*}

\begin{equation*}
  \mathbb{I} = \left\| 1 \right\|_{p \in I},
\end{equation*}

\begin{equation*}
  N_e = n_e \cdot \mathbb{I},
  \qquad e \in \left\{ x, y, z \right\},
\end{equation*}

\begin{equation*}
  N_{ij} = n_i \cdot n_j,
  \qquad i, j \in \left\{ x, y, z \right\},
\end{equation*}

\begin{equation*}
  y = \left\| y^p \right\|_{p \in I}
\end{equation*}

\begin{equation*}
  Y = y \cdot \mathbb{I}
\end{equation*}

\begin{equation*}
  Y_e = y \cdot n_e,
  \qquad e \in \left\{ x, y, z \right\}.
\end{equation*}

\begin{equation*}
  \begin{bmatrix}
    N_{xx} & N_{xy} & N_{xz} & N_{x} \\
    N_{xy} & N_{yy} & N_{yz} & N_{y} \\
    N_{xz} & N_{yz} & N_{zz} & N_{z} \\
    N_{x} & N_{y} & N_{z} & \mathbb{I}
  \end{bmatrix}
  \cdot
  \begin{bmatrix}
    l_x \\
    l_y \\
    l_z \\
    c
  \end{bmatrix}
  =
  \begin{bmatrix}
    Y_x \\
    Y_y \\
    Y_z \\
    Y
  \end{bmatrix}.
\end{equation*}

